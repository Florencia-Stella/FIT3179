{
   "$schema":"https://vega.github.io/schema/vega/v5.json",
   "description":"A calendar visualization of daily average temperatures",
   "padding":5,
   "width":700,
   "height":200,
   "signals":[
      {
         "name":"step",
         "value":16
      },
      {
         "name":"offset",
         "value":10
      },
      {
         "name":"width",
         "update":"step * 52 + offset * 11"
      },
      {
         "name":"height",
         "update":"step * 5"
      }
   ],
   "data":[
      {
         "name":"tempData",
         "url":"https://raw.githubusercontent.com/Florencia-Stella/FIT3179/main/data/avgtemp_data_2018_2020.csv",
         "format":{
            "type":"csv",
            "parse":{
               "date":"date"
            },
            "csv":{
               "delimiter":",",
               "header":[
                  "date",
                  "avg_Tavg"
               ]
            }
         },
         "transform":[
            {
               "type":"formula",
               "expr":"year(datum.date)",
               "as":"year"
            },
            {
               "type":"timeunit",
               "field":"date",
               "units":[
                  "year",
                  "week"
               ],
               "as":[
                  "w0",
                  "w1"
               ]
            },
            {
               "type":"formula",
               "expr":"timeOffset('day', datum.w0)",
               "as":"w0"
            },
            {
               "type":"timeunit",
               "field":"date",
               "units":[
                  "day"
               ],
               "as":[
                  "d0",
                  "d1"
               ]
            }
         ]
      }
   ],
   "scales":[
      {
         "name":"y",
         "type":"band",
         "domain":{
            "data":"tempData",
            "field":"d0",
            "sort":true
         },
         "range":{
            "step":{
               "signal":"step"
            }
         }
      },
      {
         "name":"color",
         "type":"linear",
         "clamp":true,
         "range":{
            "signal":"['#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#a50f15', '#67000d']"
         },
         "domain":{
            "data":"tempData",
            "field":"avg_Tavg"
         }
      }
   ],
   "legends":[
      {
         "fill":"color",
         "title":"Average Temperature (°C)",
         "titleFontSize":12,
         "titleOrient":"left",
         "titlePadding":20,
         "offset":15,
         "orient":"top",
         "type":"gradient",
         "direction":"horizontal",
         "gradientLength":250,
         "gradientThickness":10,
         "format":".1f"
      }
   ],
   "layout":{
      "columns":1,
      "padding":15
   },
   "marks":[
      {
         "type":"group",
         "from":{
            "facet":{
               "data":"tempData",
               "name":"values",
               "groupby":"year"
            }
         },
         "sort":{
            "field":"datum.year",
            "order":"descending"
         },
         "scales":[
            {
               "name":"x",
               "type":"band",
               "domain":{
                  "data":"values",
                  "field":"w0",
                  "sort":true
               },
               "range":{
                  "step":{
                     "signal":"step"
                  }
               }
            }
         ],
         "axes":[
            {
               "orient":"left",
               "scale":"y",
               "ticks":false,
               "domain":false,
               "labelPadding":8,
               "format":"%a",
               "formatType":"time",
               "title":{
                  "signal":"parent.year"
               },
               "titleAngle":0,
               "titleAlign":"right",
               "titleX":-8,
               "titleY":-2,
               "titleFontSize":11
            },
            {
               "orient":"top",
               "scale":"x",
               "ticks":false,
               "domain":false,
               "format":"%b",
               "formatType":"time",
               "labelAlign":"left",
               "encode":{
                  "labels":{
                     "update":{
                        "x":{
                           "scale":"x",
                           "field":"value",
                           "band":0,
                           "offset":{
                              "signal":"month(datum.value) * offset"
                           }
                        },
                        "opacity":{
                           "signal":"date(datum.value) < 8 ? 1 : 0"
                        }
                     }
                  }
               }
            }
         ],
         "marks":[
            {
               "type":"rect",
               "from":{
                  "data":"values"
               },
               "encode":{
                  "enter":{
                     "x":{
                        "scale":"x",
                        "field":"w0",
                        "offset":{
                           "signal":"month(datum.date) * offset"
                        }
                     },
                     "width":{
                        "scale":"x",
                        "band":1,
                        "offset":-1
                     },
                     "y":{
                        "scale":"y",
                        "field":"d0"
                     },
                     "height":{
                        "scale":"y",
                        "band":1,
                        "offset":-1
                     },
                     "cornerRadius":{
                        "value":2
                     },
                     "tooltip":{
                        "signal":"{'Date': timeFormat(datum.date, '%a %b %d, %Y'), 'Temp (°C)': format(datum.avg_Tavg, '.1f')}"
                     }
                  },
                  "update":{
                     "fill":{
                        "scale":"color",
                        "field":"avg_Tavg"
                     }
                  }
               }
            }
         ]
      }
   ]
}